@using Admin.Model.ViewModel
@using AzDoc.App_LocalResources
@using AzDoc.Helpers
@{
    Layout = "~/Views/Shared/_LeftMenuLayout.cshtml";
    RouteData routeData = ViewContext.RouteData;
    var routeValueDictionary = new RouteValueDictionary(routeData.Values);
    var _lang = routeValueDictionary["lang"] ?? "az";
    var dataIndex = ViewBag.PageIndex;
}
<div class="row no-gutters mt-4">
    <div class="">
        <div>
            <button id="newOrganisationsForRendering" class="mBtn mBtn-pr" style="width: 100%"> <i class="fas fa-plus">Yeni qurum yarat</i></button>
        </div>
    </div>
    <div class="col-3">
        <nav aria-label="breadcrumb" style="width:400px">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="\">Ana səhifə</a></li>
                <li class="breadcrumb-item"><a href="#">Admin</a></li>
                <li class="breadcrumb-item active" aria-current="page">Sənədə bağlı qurumlar</li>
            </ol>
        </nav>
    </div>
</div>
<div class="col-md-12" id="DocGrid" style="padding-top: 10px; height: 86vh">
    @Html.Partial("OrganisationForRenderingGridViewPartial")
</div>

<div class="col-md-12" id="organisationForRendering" style="padding-top: 10px; height: 86vh">
    @Html.Partial("OrganisationForRenderingPanel", new RenderOrganisations())
</div>

@section scripts
{
    <script>
        /*==============================================*/
        function RemoveOrganisationsForRendering(item, boundData) {

            Swal.fire({
                title: 'Sənədə bağlı qurum silinsinmi?',
                type: 'warning',
                showCancelButton: true,
                cancelButtonText: 'Ləğv et',
                confirmButtonText: 'Təsdiqlə'
            }).then((result) => {
                if (result.value) {
                    var values = { orgForRendering: boundData.Id };
                    $.ajax({
                        url: '/@_lang/AdminPanel/OrganizationStructure/RemoveOrgsForRendering',
                        type: 'POST',
                        data: JSON.stringify(values),
                        contentType: 'application/json; charset=utf-8',
                        success: function (response) {
                            if (response) {
                                var pageIndex = $('#gridOrganisationsForRendering').CachedGrid().config.params.pageIndex;
                                $("#gridOrganisationsForRendering").bindgrid(pageIndex);
                                Swal.fire({

                                    type: 'success',
                                    title: 'Sənədə bağlı qurum silindi',
                                    showConfirmButton: false,
                                    timer: 1000
                                });

                            }
                            else {
                                Swal.fire({
                                    type: 'error',
                                    title: 'Xəta baş verdi',
                                    showConfirmButton: false,
                                    timer: 1000
                                });
                            }
                        },
                        beforeSend: function() {
                            window.ShowLoading();
                        },
                        complete: function() {
                            window.CloseLoading();
                        }
                    });
                }
            });
        }

        /*=============================*/
        function onFilter(sender, args, query) {
            $('#gridOrganisationsForRendering').bindgrid(1);
        }
        /*=============================*/

        $("#newOrganisationsForRendering").click(function() {
            $.get("/@_lang/AdminPanel/OrganizationStructure/GetCreateOrganisationsForRendering", function (data) {
                $("#organisationForRendering").html(data);
                $("#editOrganisationForRendering").modal('show');
            });
        });

        function EditOrganisationsForRendering(item, boundData) {
            $.get(`/@_lang/AdminPanel/OrganizationStructure/GetEditOrganisationsForRendering?orgForRendering=${boundData.Id}`, function (data) {
                $("#organisationForRendering").html(data);
                $("#editOrganisationForRendering").modal('show');
            });
        }
    </script>

    <script src="~/Scripts/common/sweetalert.min.js?v=@AppVersion.Version"></script>
}
@model Admin.Model.ViewModel.AuthorityRelatedModel.PassAuthorityTransfer
@using AzDoc.Helpers
@using AzDoc.App_LocalResources
@using BLL.Models.Document

@{
    ViewBag.Title = "Səlahiyyətlər";
    Layout = "~/Views/Shared/_LeftMenuLayout.cshtml";
    RouteData routeData = ViewContext.RouteData;
    var routeValueDictionary = new RouteValueDictionary(routeData.Values);
    var lang = routeValueDictionary["lang"] ?? "az";
}
<link href="~/Content/adminPanel/adminTreeStyle.css" rel="stylesheet" />
<link href="~/Content/jquery-editable-select/jquery-editable-select.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-editable-select/jquery-editable-select.min.js?v=@AppVersion.Version"></script>
<script src="~/Scripts/common/sweetalert.min.js?v=@AppVersion.Version"></script>

<form id="authorityForm" name="authorityForm">

    <div class="col-12 mainContent">
        <div class="mainEdit contentItem" id="step1" style="padding-top:1px" data-brnum="1">
            <div class="editGroup">
                <h4>Redaktə paneli</h4>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Kimdən</label>
                                <select name="TransferredFromPerson" id="fromPerson" class="form-control selectpicker" data-live-search="true" data-width="100%">
                                    <option>Seçin</option>
                                    @foreach (var item1 in (IEnumerable<ChooseModel>)ViewBag.fromPerson)
                                    {
                                        <option value="@item1.Id">@item1.Name.ToString()</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Kimə</label>
                                <select name="TransferredToPerson" class="form-control selectpicker" data-live-search="true" data-width="100%">
                                    <option>Seçin</option>
                                    @foreach (var item2 in (IEnumerable<ChooseModel>)ViewBag.toPerson)
                                    {
                                        <option value="@item2.Id">@item2.Name.ToString()</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Səbəb</label>
                                <select name="TransferReason" class="form-control selectpicker" data-live-search="true" data-width="100%">
                                    <option>Seçin</option>
                                    @foreach (var item3 in (IEnumerable<ChooseModel>)ViewBag.transferReason)
                                    {
                                        <option value="@item3.Id">@item3.Name.ToString()</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="BeginDate">Başlama tarixi</label>
                            <input type="date" name="BeginDate" class="form-control datepicker" id="startDate" value="@DateTime.Today.ToString("yyyy-MM-dd")" autocomplete="off" />
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="finishDate">Bitmə tarixi</label>
                            <input type="date" name="EndDate" class="form-control" value="@DateTime.Today.ToString("yyyy-MM-dd")" id="finishDate" autocomplete="off" />
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Status</label>
                                <select name="AuthorityStatus" class="form-control selectpicker" data-live-search="true" data-width="100%">
                                    <option value="1">Aktiv</option>
                                    <option value="0">Deaktiv</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <div class="form-group">
                                <label>Qeyd</label>
                                <textarea id="authorityNote" name="TransferNote" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>
        <div class="row mb-5 pb-5 mt-4">
            <div class="col-12 text-center">
                <button type="button" class="mBtn mBtn-sec mr-2" onclick="window.history.go(-1); return false;">
                    @RLang.PrevStep
                </button>
                <button id="submitForm" type="button" class="mBtn mBtn-pr next-step">
                    @RLang.Save
                </button>
            </div>
        </div>
    </div>
</form>
<script>

    $(document).on("click","#submitForm",
        function () {
            var form = $('#authorityForm').getFormData();
            console.log(form);
            $.ajax({
                url: "/@lang/AdminPanel/OrganizationStructure/CreateTransferAutority",
               
                type: 'POST',
                data: form,
                success: function(response) {
                    if (response) {
                        setTimeout(function() {
                            window.location.href = '/@lang/AdminPanel/OrganizationStructure/AuthorityTransferIndex';
                        }, 1000);
                    }
                    else {
                        Swal.fire({
                            type: 'error',
                            title: 'Xəta baş verdi',
                            showConfirmButton: false,
                            timer: 1000
                        });
                    }
                },
                error: function (response) {
                },
                beforeSend: function () {
                    window.ShowLoading();
                },
                complete: function () {
                    window.CloseLoading();
                }
            });
        });
</script>
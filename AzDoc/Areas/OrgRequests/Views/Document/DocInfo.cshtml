@using AzDoc.App_LocalResources
@using AzDoc.Helpers
@using BLL.Common.Enums.DMSEnums
@using CustomHelpers.Classes
@using OrgRequests.Model.ViewModel
@using OrgRequests.Model.EntityModel
@model OrgRequests.Model.ViewModel.DocumentInfoViewModel
@{
    var docStatus = new[] {(int)DocumentStatus.Draft,
(int)DocumentStatus.IsViza,
(int)DocumentStatus.Signing,
(int)DocumentStatus.Execution,
(int)DocumentStatus.Printed,
(int)DocumentStatus.Mailed
};

    RouteData routeData = ViewContext.RouteData;

    var routeValueDictionary = new RouteValueDictionary(routeData.Values);

    var lang = routeValueDictionary["lang"] ?? "az";
    //var newDateArray = Model.NewPlanedHistory.Split(',');

}
<head>
    <title>Qeydiyyat vərəqəsi @(Model.RegisterNumber ?? string.Empty) </title>
    @if (!Request.IsAjaxRequest())
    {
        <link href="~/Content/bootstrap/bootstrap.min.css" rel="stylesheet" />
        <link href="~/Content/fontawesome/css/all.min.css" rel="stylesheet" />
        <link href="~/Content/common/style.css" rel="stylesheet" />
        <script src="~/Scripts/jquery/jquery-3.3.1.min.js"></script>
        <script src="~/Scripts/bootstrap/bootstrap.min.js"></script>
        <script src="~/Scripts/jquery/jquery-blockUI.js"></script>
        @GleamTechHelper.Head
        @GleamTechHelper.Js
    }
</head>


<style>
    @@media print {
        .btn {
            display: none;
        }
    }

    .center {
        text-align: center;
        vertical-align: middle;
    }
</style>
<span id="spanToken" style="display: none">@ViewData["Token"]</span>
<div id="view">
    <div class="container-fluid" style="padding-left: 15px!important">
        <div class="row justify-content-center">
            <div class="col-xl-10 col-12">
                <div class="row">
                    <div class="col-12">
                        <div class="headingRow">
                            <h3>@Model.OrganizationName</h3>
                        </div>
                    </div>
                </div>


                <div class="mainView">
                    <div class="row">
                        <div class="col-12">
                            <div class="viewHeading">
                                <h3>Qeydiyyat nəzarət vərəqəsi</h3>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">

                            <div id="docContent" class="viewGroup appealing">

                                <div class="col-12">
                                    <h4 class="text-center align-content-center">@Model.ModuleName</h4>
                                    @if (Model.DocDuplicateId == 1)
                                    {
                                        <p class="text-right align-content-center" style="color: red">Təkrar müraciət</p>
                                    }

                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="qnv">
                                                <th>Qeydiyyat nömrəsi</th>
                                                <td class="custom-table-cell">@Model.RegisterNumber</td>
                                                <th>Qeydiyyat tarixi</th>
                                                @if (Model.RegisterDate != null)
                                                {
                                                    <td class="custom-table-cell">@Model.RegisterDate.Value.ToString("d")</td>
                                                }
                                                else
                                                {
                                                    <td class="custom-table-cell">@Model.RegisterDate</td>
                                                }
                                            </tr>

                                            <tr class="qnv">
                                                <th>Sənədin nömrəsi</th>
                                                <td class="custom-table-cell">@Model.DocumentNumber</td>
                                                <th>Sənədin tarixi</th>
                                                @if (Model.DocumentDate != null)
                                                {
                                                    <td class="custom-table-cell">@Model.DocumentDate.Value.ToString("d")</td>
                                                }
                                                else
                                                {
                                                    <td class="custom-table-cell">@Model.DocumentDate</td>
                                                }
                                            </tr>
                                            <tr class="qnv">
                                                <th>Haradan daxil olub</th>
                                                <td class="custom-table-cell">@Model.EntryFromWhere</td>
                                                <th>İcra qaydası</th>
                                                <td class="custom-table-cell">@Model.ExecuteRule</td>
                                            </tr>
                                            <tr class="qnv">
                                                <th style="vertical-align: middle;">Kimdən daxil olub</th>
                                                <td class="custom-table-cell">@Model.EntryFromWho</td>
                                                <th style="vertical-align: middle;">İcra müddəti</th>

                                                @if (Model.ExecDuration != null)
                                                {
                                                    <td class="custom-table-cell">

                                                        @Model.ExecDuration.Value.ToString("d")
                                                        <br />

                                                        @Html.Raw(HttpUtility.HtmlDecode(Model.NewPlannedDateHistory))
                                                    </td>

                                                }
                                                else
                                                {
                                                    <td class="custom-table-cell">@Model.ExecDuration</td>
                                                }
                                            </tr>
                                            <tr class="qnv">
                                                <th>Hara ünvanlanıb</th>
                                                <td class="custom-table-cell">@Model.SendToWhere</td>
                                                <th>Sənədin növü</th>
                                                <td class="custom-table-cell">@Model.DocumentKind</td>
                                            </tr>

                                            <tr class="qnv">
                                                <th>Kimə ünvanlanıb</th>
                                                <td class="custom-table-cell">@Model.SendToWho</td>
                                                <th>Daxil olma forması</th>
                                                <td class="custom-table-cell">@Model.EntryForm</td>
                                            </tr>

                                            <tr class="qnv">
                                                <th>Mövzu</th>
                                                <td class="custom-table-cell">@Model.Subject</td>
                                                <th>Sənədin statusu</th>
                                                <td class="custom-table-cell">@Model.DocumentStatus</td>
                                            </tr>

                                            @if (Model.DocExecutedDate.HasValue && Model.DocExecutedDate != DateTime.MinValue)
                                            {
                                                <tr>
                                                    <td style="border-right:none"></td>
                                                    <td style="border-left:none"></td>
                                                    <th>Sənədin icra olunma tarixi</th>
                                                    <td class="custom-table-cell">@(Model.DocExecutedDate?.ToString("d"))</td>
                                                </tr>
                                            }
                                        </thead>
                                    </table>
                                </div>

                                <div class="col-12">
                                    <h4 class="text-center">Sənədin qısa məzmunu</h4>
                                    <table class="table table-bordered">
                                        <tbody>
                                            <tr>
                                                <td>@Model.ShortContent</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                @Html.Partial("~/Views/DocInfo/_DocFiles.cshtml", Model.DocFiles)

                                @Html.Partial("~/Views/DocInfo/_AnswerDoc.cshtml", Model.AnswerDocs)

                                @Html.Partial("~/Views/DocInfo/_EnteredDoc.cshtml", Model.EnteredDocs)

                                @Html.Partial("~/Views/DocInfo/_RelatedDoc.cshtml", Model.RelatedDocs)

                                @Html.Partial("~/Views/DocInfo/_DocTasks.cshtml", Model.DocTasks)

                                @if (Model.SupervisionId == 1 || Model.ExecutionStatusId == 3)
                                {
                                    <div class="col-md-12">
                                        <h4 class="text-center">Nəzarət</h4>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th class="thead left">Nəzarətə götürən</th>
                                                    <th class="thead left">Nəzarətə götürülmə tarixi</th>
                                                    <th class="thead left">İcra muddəti</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.SupervisionId == 1 && Model.ExecutionStatusId == 3)
                                                {
                                                    <tr>
                                                        <td align='left' style="color: red">@Model.EntryFromWhere</td>
                                                        <td align='left'>@Model.RegisterDate.Value.ToString("d")</td>
                                                        <td align='left'>
                                                            @if (@Model.ExecDuration != null)
                                                            {
                                                                @Model.ExecDuration.Value.ToString("d")
                                                            }
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td align='left' style="color: red">@Model.SendToWhere</td>
                                                        <td align='left'>@Model.RegisterDate.Value.ToString("d")</td>
                                                        <td align='left'>
                                                            @if (@Model.ExecDuration != null)
                                                            {
                                                                @Model.ExecDuration.Value.ToString("d")
                                                            }
                                                        </td>
                                                    </tr>


                                                }
                                                else if (Model.SupervisionId == 1 && Model.ExecutionStatusId != 3)
                                                {
                                                    <tr>
                                                        <td align='left' style="color: red">@Model.EntryFromWhere</td>
                                                        <td align='left'>@Model.RegisterDate.Value.ToString("d")</td>

                                                        <td align='left'>
                                                            @if (@Model.ExecDuration != null)
                                                            {
                                                                @Model.ExecDuration.Value.ToString("d")
                                                            }
                                                        </td>


                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td align='left' style="color: red">@Model.SendToWhere</td>
                                                        <td align='left'>@Model.RegisterDate.Value.ToString("d")</td>
                                                        <td align='left'>
                                                            @if (@Model.ExecDuration != null)
                                                            {
                                                                @Model.ExecDuration.Value.ToString("d")
                                                            }
                                                        </td>
                                                    </tr>

                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                }

                                @Html.Partial("~/Views/DocInfo/_DocDirectionHistory.cshtml", Model.DocHistory)


                            </div>
                        </div>
                    </div>


                </div>
                <a href="#" class="circleBtn" style="position: fixed; top: 40px; right: 5%;" id="print"><i class="fas fa-print"></i></a>

            </div>
        </div>
    </div>
</div>


<script src="~/Scripts/common/printThis.min.js"></script>
<script>


    $('#print').click(function () {
        hidden();
        $('#view').printThis();
    });

    function fileShow(docInfoId) {
        var spanToken = $('#spanToken').html();
        var subPathName = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
        if (subPathName == 'GetDocView') {
            $.ajax({
                type: 'GET',
                url: '/@lang/OrgRequests/Document/DocumentDisplay',
                data: { docInfoId: docInfoId },
                beforeSend: function() {
                    window.ShowLoading();

                },
                success: function (data1) {

                    $.ajax({
                        type: 'GET',
                        url: `/@lang/Document/GetDocView?token=${spanToken}`,
                        dataType: 'html',
                        success: function (data) {
                            $("#view").html(data);
                            $("#docDisplay").html(data1);
                            $('#trDocFileView').show();
                        }
                    });

                },
                complete: function() {
                    window.CloseLoading();
                }

            });

        } else {

            $.ajax({
                type: 'GET',
                url: '/@lang/OrgRequests/Document/DocumentDisplay',
                dataType: 'html',
                data: { docInfoId: docInfoId },
                beforeSend: function() {
                    window.ShowLoading();
                },
                success: function (response) {
                    $("#DocViewer").html(response);
                    $('#docElectronic').addClass('individual active');
                    $('#docElectronic').removeClass('juridical');
                    $('#ElectronicDocument').removeClass('d-none');

                    $('#docDocInfo').removeClass('individual active');
                    $('#docDocInfo').addClass('juridical');
                    $('#DocInfo').addClass('d-none');

                    $('#JsonFile').val(docInfoId);
                },
                complete: function() {
                    window.CloseLoading();
                }

            });
        }
    };

    $('#closeDocViewer').click(function() {
        hidden();
    });

    function hidden() {
        $('#documentDisplay').css('display', 'none');
        $('#closeButton').css('display', 'none');
    }
</script>